#!/usr/bin/env sh

# ãƒ—ãƒƒã‚·ãƒ¥å‰ã®æœ€çµ‚ãƒã‚§ãƒƒã‚¯

# è‰²å®šç¾©
RED="\033[1;31m"
GREEN="\033[1;32m"
CYAN="\033[1;36m"
RESET="\033[0m"

echo "${CYAN}ğŸš€ Pre-push checks...${RESET}"

# mainãƒ–ãƒ©ãƒ³ãƒã¸ã®ç›´æ¥ãƒ—ãƒƒã‚·ãƒ¥ã‚’é˜²ã
BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$BRANCH" = "main" ]; then
  echo "${RED}âŒ Direct push to main branch is not allowed!${RESET}"
  echo "Please create a pull request instead."
  exit 1
fi

# ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
echo "ğŸ§ª Running tests..."
if ! npm test > /dev/null 2>&1; then
  echo "${RED}âŒ Tests failed. Fix them before pushing.${RESET}"
  npm test
  exit 1
fi

# ãƒ“ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
echo "ğŸ”¨ Checking build..."
if ! npm run build > /dev/null 2>&1; then
  echo "${RED}âŒ Build failed.${RESET}"
  npm run build
  exit 1
fi

echo "${GREEN}âœ… All pre-push checks passed!${RESET}"