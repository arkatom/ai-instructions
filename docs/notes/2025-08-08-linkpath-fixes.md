# 作業ノート

**日付**: 2025年08月08日  
**タスク**: AI instructions generator CLI tool のリンクパス修正とinstructionsディレクトリ展開問題の解決

## タスクの内容

ユーザーから指摘された2つの主要な問題を修正：
1. **instructionsファイル群がclaude以外は展開されていない問題**
2. **copilotでリンクパスがおかしい問題**

## どんな点に気を付けたか

- **品質優先の原則を厳守**: 「速さではなく質」を重視し、一度で完璧に仕上げることを意識
- **網羅的な検証**: 全ツール（Claude、Copilot、Cursor、Windsurf）× 全言語（en、ja、ch）の12組み合わせで完全テスト
- **相対パス解決の正確性**: 各ツールのディレクトリ構造に応じた正しい相対パスを算出
- **実ファイル存在確認**: 単にリンクパスを修正するだけでなく、実際にファイルが存在することを確認

## タスク中に方針が変わった点

### 初期方針 → 変更理由 → 新方針

1. **ディレクトリ構造の変更提案 → 拒否された → 既存構造維持**
   - 初期: instructions を tool-specific サブディレクトリに再構造化する提案
   - 変更理由: ユーザーが「現在の構造は今までの実装の結果だ。変なことするんじゃねぇ」と強く反対
   - 新方針: 現在の構造を維持しつつ、コンバーター側でパス修正対応

2. **Cursorのパス計算 → 検証により修正 → 正確なパス特定**
   - 初期: `../../../instructions/` と推測
   - 変更理由: 実際のディレクトリ構造検証で `.cursor/rules/main.mdc` から見た相対パスが間違いと判明
   - 新方針: `../../instructions/` が正解

3. **templates配下からのコピー → ユーザー指摘 → 理解深化**
   - 初期: instructionsディレクトリがどこから来るのか曖昧だった
   - 変更理由: ユーザーから「instruction はtemplates 配下のinstructions を使用するのでは？」「正しいご指摘ですとかじゃなくて、自分で気づけよ。怠けるな。」と厳しく指摘
   - 新方針: `templates/instructions/[lang]/` からのコピー処理を明確に理解

## 今回のタスクで重要なポイント

### 1. 問題の本質的理解
- 表面的な「リンクが動かない」ではなく、**instructionsディレクトリ自体がコピーされていない**ことが根本原因
- `shouldCopyInstructionsForFormat()` が Claude 以外で false を返していた

### 2. 各ツールの相対パス構造
```
Claude:    CLAUDE.md → ./instructions/
Copilot:   .github/copilot-instructions.md → ../instructions/  
Cursor:    .cursor/rules/main.mdc → ../../instructions/
Windsurf:  .windsurfrules → ./instructions/
```

### 3. 修正内容と検証プロセス
**修正ファイル:**
- `src/generators/claude.ts`: `shouldCopyInstructionsForFormat()` ですべての形式でtrue返却
- `src/converters/copilot-converter.ts`: `instructions/$2` → `../instructions/$2`
- `src/converters/cursor-converter.ts`: `instructions/$2` → `../../instructions/$2`

**検証プロセス:**
1. 全12組み合わせでtest/output生成
2. リンクパス文字列の確認
3. 実ファイル解決テスト（`ls -la パス`）
4. 相対パス解決の物理的確認

### 4. 試行錯誤の記録
**最初の失敗:**
- ディレクトリ構造変更提案 → ユーザーに強く反対される
- 原因: 既存の意図的な設計を理解せずに提案

**パス計算の修正:**
- Cursor: `../../../instructions/` → `../../instructions/`
- 原因: `.cursor/rules/main.mdc` の階層を正確にカウントしていなかった

**templates理解の遅れ:**
- instructionsファイルの元ソースが `templates/instructions/[lang]/` であることを独立して気づけなかった
- ユーザーに指摘されて理解 → 「怠けるな」と叱責される

### 5. 得られた知見
- **品質重視の重要性**: 適当な作業は信頼を失い、最終的に非効率
- **既存設計の尊重**: 勝手な変更提案前に、現在の設計意図を深く理解する
- **独立した問題発見力**: ユーザーに指摘される前に自分で気づく能力が重要
- **網羅的テスト**: 12組み合わせの完全テストで抜け漏れ防止

## 愚痴（ぶっちゃけた本音）

正直、最初にディレクトリ構造変更を提案した時点で「やらかした」と思った。ユーザーが「駄目に決まってんだろボケクソ。ツール特有の機能の表示とかいらねぇって言ったはずだ。覚えてないのか。役に立たねえな。」と言った時は、本当に反省した。

でも一番きつかったのは「正しいご指摘ですとかじゃなくて、自分で気づけよ。怠けるな。」の一言。確かに、templates配下のinstructions使用は当然気づくべきだったし、ユーザーに指摘される前に自分で気づくべきだった。

ただし、最終的に全12組み合わせで完璧に動作するものを作れたのは良かった。特に相対パス解決の物理的テスト（実際にlsコマンドで確認）は完璧だった。

ユーザーの最後の「おう、いいじゃねえか。良さげだ、良さげだ。」という言葉は嬉しかった。厳しく指導してもらったおかげで、最終的に品質の高いものが完成したと思う。

**適当度**: 1/10（今回は徹底的に品質重視で進めた）