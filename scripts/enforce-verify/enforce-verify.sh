#!/bin/bash

# Enforce Verify - Git検証強制システム
# このスクリプトは git コマンドをラップし、--no-verify の使用を防ぐ

# 警告メッセージ
WARNING_MESSAGE="
════════════════════════════════════════════════════════════════════════
  🚫 エラー: --no-verify フラグの使用は禁止されています 🚫

  チェックを設定した意味を無に帰す行為であり、
  あなたの信頼と価値も同様に無に帰すこととメモリに強く刻んでください。

  テストエラーがある場合は、必ず修正してから再度実行してください。
════════════════════════════════════════════════════════════════════════
"

# 引数をチェック
if [[ "$@" == *"--no-verify"* ]] || [[ "$@" == *"-n"* ]]; then
  echo "$WARNING_MESSAGE" >&2
  
  # ログに記録
  echo "[$(date '+%Y-%m-%d %H:%M:%S')] BLOCKED: git $@" >> logs/no-verify-blocked.log
  
  # エラーコードで終了（コマンドを実行しない）
  exit 1
fi

# 通常のgitコマンドを実行
/usr/bin/git "$@"
